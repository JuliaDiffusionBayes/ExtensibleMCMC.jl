<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Updates &amp; Decorators · ExtensibleMCMC.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">ExtensibleMCMC.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../get_started/basic_use/">Get started</a></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox" checked/><label class="tocitem" for="menuitem-3"><span class="docs-label">User manual</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../internal_structure/">Internal structure</a></li><li class="is-active"><a class="tocitem" href>Updates &amp; Decorators</a><ul class="internal"><li><a class="tocitem" href="#Metropolis-Hastings-with-random-walk-proposals-1"><span>Metropolis Hastings with random walk proposals</span></a></li><li><a class="tocitem" href="#Metropolis-adjusted-Langevin-algorithm-(MALA)-1"><span>Metropolis-adjusted Langevin algorithm (MALA)</span></a></li><li><a class="tocitem" href="#Hamiltonian-Monte-Carlo-1"><span>Hamiltonian Monte Carlo</span></a></li><li class="toplevel"><a class="tocitem" href="#Custom-MCMC-updates-and-decorators-1"><span>Custom MCMC updates and decorators</span></a></li></ul></li><li><a class="tocitem" href="../callbacks/">Callbacks</a></li><li><a class="tocitem" href="../priors/">Priors</a></li><li><a class="tocitem" href="../workspaces/">Workspaces</a></li><li><a class="tocitem" href="../mcmc_schedule/">MCMC Schedule</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">How to...</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../how_to_guides/first_how_to/">(TODO) First how to</a></li><li><a class="tocitem" href="../../how_to_guides/define_my_own_workspace/">(TODO) Definy my own workspace</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../tutorials/mean_of_bivariate_gaussian/">Estimate mean of a bivariate Gaussian</a></li></ul></li><li><a class="tocitem" href="../../module_index/">Index</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">User manual</a></li><li class="is-active"><a href>Updates &amp; Decorators</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Updates &amp; Decorators</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaDiffusionBayes/ExtensibleMCMC.jl/blob/master/docs/src/manual/updates_and_decorators.md#L" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Updates-1"><a class="docs-heading-anchor" href="#Updates-1">Updates</a><a class="docs-heading-anchor-permalink" href="#Updates-1" title="Permalink"></a></h1><p>Updates are structs that hold instructions about the MCMC updates. Apart from ... each <code>update</code> must implement</p><article class="docstring"><header><a class="docstring-binding" id="ExtensibleMCMC.log_transition_density-Tuple{ExtensibleMCMC.MCMCParamUpdate,Any,Any}" href="#ExtensibleMCMC.log_transition_density-Tuple{ExtensibleMCMC.MCMCParamUpdate,Any,Any}"><code>ExtensibleMCMC.log_transition_density</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">log_transition_density(updt::MCMCParamUpdate, θ, θ°)</code></pre><p>Evaluates the log-transition density for an update θ → θ°</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaDiffusionBayes/ExtensibleMCMC.jl/blob/8a36c4b53cc91b6d299c8041649131fa77830fb3/src/updates.jl#LL51-L55">source</a></section></article><h2 id="Metropolis-Hastings-with-random-walk-proposals-1"><a class="docs-heading-anchor" href="#Metropolis-Hastings-with-random-walk-proposals-1">Metropolis Hastings with random walk proposals</a><a class="docs-heading-anchor-permalink" href="#Metropolis-Hastings-with-random-walk-proposals-1" title="Permalink"></a></h2><p>The simplest type of updates are Metropolis-Hastings updates with random walk proposals.</p><article class="docstring"><header><a class="docstring-binding" id="ExtensibleMCMC.RandomWalkUpdate" href="#ExtensibleMCMC.RandomWalkUpdate"><code>ExtensibleMCMC.RandomWalkUpdate</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">struct RandomWalkUpdate{TRW,TA,K,TP} &lt;: MCMCParamUpdate
    rw::TRW
    adpt::TA
    loc2glob_idx::K
    prior::TP
end</code></pre><p>Definition of an MCMC update that uses Metropolis-Hastings algorithm with random walk proposals. <code>rw</code> is the random walk sampler, <code>adpt</code> is the struct responsible for adaptation of hyperparameters, <code>loc2glob_idx</code> lists the coordinate indeces of the global <code>state</code> that the given update operates on and <code>prior</code> is a prior for this update step (i.e. for a given subset of parameter vector).</p><pre><code class="language-none">    function RandomWalkUpdate(
        rw::TRW,
        idx_of_global::K;
        prior::TP=ImproperPrior(),
        adpt::TA=NoAdaptation()
    ) where {TRW&lt;:RandomWalk,K,TA,TP}

Base constructor.</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaDiffusionBayes/ExtensibleMCMC.jl/blob/8a36c4b53cc91b6d299c8041649131fa77830fb3/src/updates.jl#LL11-L34">source</a></section></article><p>The random walk can be any viable distribution, below we present two cases that have been implemented.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>Very often we only need to update a subset of the parameters as in the Metropolis-within-Gibbs algorithm. This is easily done by specifying the indices of relevant coordinates in <code>idx_of_global</code> field in the constructor.</p></div></div><h3 id="Uniform-Random-Walker-1"><a class="docs-heading-anchor" href="#Uniform-Random-Walker-1">Uniform Random Walker</a><a class="docs-heading-anchor-permalink" href="#Uniform-Random-Walker-1" title="Permalink"></a></h3><p>The simplest type of walker is a Uniform random walker. It samples</p><div>\[U_i\sim\texttt{Unif([}-\epsilon,\epsilon\texttt{])},\quad i\in\texttt{idx_of_global},\]</div><p>and then, advances each state according to</p><div>\[X_i + U_i,\quad i\in\texttt{idx_of_global}.\]</div><article class="docstring"><header><a class="docstring-binding" id="ExtensibleMCMC.UniformRandomWalk" href="#ExtensibleMCMC.UniformRandomWalk"><code>ExtensibleMCMC.UniformRandomWalk</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">mutable struct UniformRandomWalk{T,S} &lt;: RandomWalk
    ϵ::T
    pos::S
end</code></pre><p>A uniform random walker that moves all unrestricted coordinates according to the additive rule xᵢ+U, with U∼Unif(-ϵᵢ,ϵᵢ) and moves all coordinates restricted to be positive according to the rule xᵢexp(U), with U∼Unif(-ϵᵢ,ϵᵢ).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaDiffusionBayes/ExtensibleMCMC.jl/blob/8a36c4b53cc91b6d299c8041649131fa77830fb3/src/transition_kernels/random_walk.jl#LL23-L32">source</a></section></article><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>In practice, some coordinates of the parameter vector may be restricted to take only positive values. We may impose this restriction by performing a &quot;multiplicative exponentiated uniform random walk&quot; for such coordinates. Such random walk is no longer uniform on the original space, but is uniform in steps for <span>$\log(X_i)$</span>.</p></div></div><h4 id="Adaptation-1"><a class="docs-heading-anchor" href="#Adaptation-1">Adaptation</a><a class="docs-heading-anchor-permalink" href="#Adaptation-1" title="Permalink"></a></h4><p>The uniform random walker depends on the hyper-parameter <span>$ϵ$</span>, which has a large effect on the learning speed of the MCMC sampler. This hyper-parameter can be learned adaptively in a standard way, by targeting the acceptance rate of the sampler. To turn the adaptation on we have to pass an appropriately initialized <code>AdaptationUnifRW</code> as a keyword argument <code>adpt</code>:</p><article class="docstring"><header><a class="docstring-binding" id="ExtensibleMCMC.AdaptationUnifRW" href="#ExtensibleMCMC.AdaptationUnifRW"><code>ExtensibleMCMC.AdaptationUnifRW</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">mutable struct AdaptationUnifRW{T} &lt;: Adaptation
    proposed::Int64
    accepted::Int64
    target_accpt_rate::Float64
    adapt_every_k_steps::Int64
    scale::T
    min::T
    max::T
    offset::T
    N::Int64
end</code></pre><p>A struct containing information about the way in which to adapt the steps of the uniform random walker. <code>proposed</code> and <code>accepted</code> are the internal counters that keep track of the number of proposed and accepted samples. <code>target_accpt_rate</code> is the acceptance rate of the Metropolis-Hastings steps that is supposed to be targetted. <code>min</code> is used to enforce the minimal allowable range that the random walker can sample from, <code>max</code> enforces the maximum. <code>offset</code> introduces some delay in the start of decelerting the adaptation extent and <code>scale</code> is a scaling parameter for adaptation speed. <code>N</code> is the number of coordinates of the random walker.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaDiffusionBayes/ExtensibleMCMC.jl/blob/8a36c4b53cc91b6d299c8041649131fa77830fb3/src/transition_kernels/adaptation.jl#LL28-L50">source</a></section></article><p>To see a simple example of a difference that adaptation can make see the <a href="manual/@ref tutorial_mean_of_bivariate_gsn_adpt">Tutorial on estimating the mean of a simple bivariate Gaussian</a></p><h3 id="Gaussian-Random-Walker-1"><a class="docs-heading-anchor" href="#Gaussian-Random-Walker-1">Gaussian Random Walker</a><a class="docs-heading-anchor-permalink" href="#Gaussian-Random-Walker-1" title="Permalink"></a></h3><p>Another implemented type of random walker is a Gaussian random walker.</p><article class="docstring"><header><a class="docstring-binding" id="ExtensibleMCMC.GaussianRandomWalk" href="#ExtensibleMCMC.GaussianRandomWalk"><code>ExtensibleMCMC.GaussianRandomWalk</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">mutable struct GaussianRandomWalk{T} &lt;: RandomWalk
    Σ::Symmetric{T,Array{T,2}}
    pos::Vector{Bool}
end</code></pre><p>A Gaussian random walker that first transforms all coordinates restricted to be positive to a log-scale via log(θᵢ), then moves according to θ°∼N(θ, Σ) and finally transforms the restricted coordinates back to the original scale via exp(θᵢ°). Restrictions are specified in the vector <code>pos</code> (and no restrictions correspond to all entries in <code>pos</code> being false).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaDiffusionBayes/ExtensibleMCMC.jl/blob/8a36c4b53cc91b6d299c8041649131fa77830fb3/src/transition_kernels/random_walk.jl#LL88-L99">source</a></section></article><p>It can be used for single-site updates as well as joint updates.</p><h4 id="Adaptation-2"><a class="docs-heading-anchor" href="#Adaptation-2">Adaptation</a><a class="docs-heading-anchor-permalink" href="#Adaptation-2" title="Permalink"></a></h4><p>The adaptation of <code>GaussianRandomWalk</code> may no longer be done as in the case of <code>UniformRandomWalk</code> (in principle, with the exception of 1-d, but this is not implemented), as the entire covariance matrix needs to be learnt now. This is instead implemented with Haario-type updates.</p><article class="docstring"><header><a class="docstring-binding" id="ExtensibleMCMC.HaarioTypeAdaptation" href="#ExtensibleMCMC.HaarioTypeAdaptation"><code>ExtensibleMCMC.HaarioTypeAdaptation</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">mutable struct HaarioTypeAdaptation{T,TF} &lt;: Adaptation
    mean::Vector{T}
    cov::Matrix{T}
    adapt_every_k_steps::Int64
    scale::Float64
    N::Int64
    M::Int64
    fλ::TF
end</code></pre><p>A struct containing information about the way in which to adapt the steps of the Gaussian random walker in a scheme: Xᵢ₊₁ = λZ+(1-λ)W, where Z ∼ N(Xᵢ, cI) and W ∼ N(Xᵢ, Σₐ), with Σₐ the covariance matrix that the adaptive scheme aims to learn. <code>mean</code> and <code>cov</code> are the empirical mean and covariance of the (appropriately log-transformed) local <code>state</code> vector. Every <code>adapt_every_k_steps</code> number of steps an adaptation is performed. <code>scale</code> is a scaling for going from the empirical covariance to the covariance of the Gaussian random walker. <code>N</code> is the total number of terms based on which the <code>mean</code> and <code>cov</code> were computed, <code>M</code> is the number of updates since the last call to adaptation and <code>fλ</code> is a function for determining the <code>λ</code> weight.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaDiffusionBayes/ExtensibleMCMC.jl/blob/8a36c4b53cc91b6d299c8041649131fa77830fb3/src/transition_kernels/adaptation.jl#LL329-L350">source</a></section></article><p>In addition, in order to run <code>HaarioTypeAdaptation</code>, the <code>update</code> transition kernel must be set to <code>GaussianRandomWalkMix</code> instead of just <code>GaussianRandomWalk</code>, for obvious reasons that follow from the description of the former:</p><article class="docstring"><header><a class="docstring-binding" id="ExtensibleMCMC.GaussianRandomWalkMix" href="#ExtensibleMCMC.GaussianRandomWalkMix"><code>ExtensibleMCMC.GaussianRandomWalkMix</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">mutable struct GaussianRandomWalkMix{T} &lt;: RandomWalk
    gsn_A::GaussianRandomWalk{T}
    gsn_B::GaussianRandomWalk{T}
    λ::Float64
end</code></pre><p>A mixture of two Gaussian random walkers. It performs updates according to Xᵢ₊₁ = Xᵢ + λZₐ + (1-λ)Zᵦ, where Zₐ ∼ N(0,Σₐ) and Zᵦ ∼ N(0, Σᵦ) (with Xᵢ being already appropriately log-transformed if needed).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaDiffusionBayes/ExtensibleMCMC.jl/blob/8a36c4b53cc91b6d299c8041649131fa77830fb3/src/transition_kernels/random_walk.jl#LL153-L163">source</a></section></article><h2 id="Metropolis-adjusted-Langevin-algorithm-(MALA)-1"><a class="docs-heading-anchor" href="#Metropolis-adjusted-Langevin-algorithm-(MALA)-1">Metropolis-adjusted Langevin algorithm (MALA)</a><a class="docs-heading-anchor-permalink" href="#Metropolis-adjusted-Langevin-algorithm-(MALA)-1" title="Permalink"></a></h2><h2 id="Hamiltonian-Monte-Carlo-1"><a class="docs-heading-anchor" href="#Hamiltonian-Monte-Carlo-1">Hamiltonian Monte Carlo</a><a class="docs-heading-anchor-permalink" href="#Hamiltonian-Monte-Carlo-1" title="Permalink"></a></h2><h1 id="Custom-MCMC-updates-and-decorators-1"><a class="docs-heading-anchor" href="#Custom-MCMC-updates-and-decorators-1">Custom MCMC updates and decorators</a><a class="docs-heading-anchor-permalink" href="#Custom-MCMC-updates-and-decorators-1" title="Permalink"></a></h1></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../internal_structure/">« Internal structure</a><a class="docs-footer-nextpage" href="../callbacks/">Callbacks »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Saturday 2 May 2020 14:11">Saturday 2 May 2020</span>. Using Julia version 1.4.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
